<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sarvam Text-to-Speech</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f6f8;
      display: flex;
      justify-content: center;
      padding: 2rem;
    }
    .card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      padding: 1.5rem;
      max-width: 560px;
      width: 100%;
    }
    h1 { font-size: 1.4rem; margin: 0 0 .5rem; color: #222; }
    p { margin: 0 0 1rem; color: #444; }
    textarea, select, button {
      width: 100%;
      font-size: 1rem;
      margin-top: .75rem;
      box-sizing: border-box;
    }
    textarea {
      min-height: 120px;
      padding: .75rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    button {
      padding: .7rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      color: #fff;
      background: #007bff;
      margin-top: .75rem;
      transition: background 0.2s;
    }
    button:hover:not([disabled]) { background: #0064d6; }
    button[disabled] { opacity: .6; cursor: not-allowed; }
    #downloadBtn { display:none; background:#00a86b; }
    #downloadBtn:hover { background:#00925f; }
    #status { margin-top: .8rem; color:#333; white-space: pre-wrap; }
    audio { margin-top: .8rem; width:100%; }
    label { margin-top:.6rem; display:block; color:#333; font-weight:500; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üó£Ô∏è Sarvam Text-to-Speech</h1>
    <p>Convert text into natural speech directly in your browser.</p>

    <textarea id="textInput" placeholder="Type your text here...">Welcome to Sarvam AI!</textarea>

    <label for="speaker">Choose a voice:</label>
    <select id="speaker">
      <option value="anushka" selected>Anushka</option>
      <option value="abhilash">Abhilash</option>
      <option value="vidya">Vidya</option>
      <option value="priya">Priya</option>
      <option value="rahul">Rahul</option>
      <option value="rohan">Rohan</option>
      <option value="neha">Neha</option>
      <option value="kriti">Kriti</option>
      <option value="simran">Simran</option>
    </select>

    <button id="convertBtn">Convert to Speech</button>
    <button id="downloadBtn">‚¨áÔ∏è Download MP3</button>

    <div id="status"></div>
    <audio id="audioPlayer" controls></audio>
  </div>

  <script>
    const API_URL = "https://api.sarvam.ai/text-to-speech";
    const API_KEY = "sk_5kk571fd_AM3ZFCIyLpBZYvo6x2F8HRU7"; // ‚ö†Ô∏è For demo use only!

    const textInput = document.getElementById("textInput");
    const speakerSelect = document.getElementById("speaker");
    const convertBtn = document.getElementById("convertBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const statusEl = document.getElementById("status");
    const audioPlayer = document.getElementById("audioPlayer");
    let currentAudioUrl = null;

    convertBtn.onclick = async () => {
      const text = textInput.value.trim();
      const speaker = speakerSelect.value;
      if (!text) { alert("Enter text first!"); return; }

      convertBtn.disabled = true;
      statusEl.textContent = "üéß Generating speech...";
      audioPlayer.src = "";
      downloadBtn.style.display = "none";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "api-subscription-key": API_KEY },
          body: JSON.stringify({
            model: "bulbul:v2",
            text,
            speaker,
            target_language_code: "en-IN",
            pitch: 0,
            pace: 1,
            loudness: 1,
            enable_preprocessing: true,
            speech_sample_rate: 22050
          })
        });

        const contentType = res.headers.get("content-type") || "";
        if (!res.ok) {
          const err = await res.text();
          throw new Error(err);
        }
        if (contentType.includes("application/json")) {
          const errJson = await res.json();
          throw new Error(JSON.stringify(errJson, null, 2));
        }

        // ‚úÖ If here, we got audio data
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        if (currentAudioUrl) URL.revokeObjectURL(currentAudioUrl);
        currentAudioUrl = url;
        audioPlayer.src = url;
        audioPlayer.play().catch(()=>{});
        downloadBtn.style.display = "inline-block";
        downloadBtn.onclick = () => {
          const a = document.createElement("a");
          a.href = url;
          a.download = "sarvam-tts.mp3";
          a.click();
        };
        statusEl.textContent = "‚úÖ Done!";
      } catch (e) {
        statusEl.textContent = "‚ùå Error:\n" + e.message;
        console.error(e);
      } finally {
        convertBtn.disabled = false;
      }
    };
  </script>
</body>
</html>
